<div class="drop-shadow">
  <div class="container mx-auto bg-white rounded-lg">
    <nz-page-header
                    class="site-page-header" [nzBackIcon]="backIcon">

    <ng-template #backIcon>
      <span class="fe fe-arrow-left fa-2x"></span>
    </ng-template>

      <nz-page-header-extra>

      <a
        (click)="showAddStopModal = true"
        class="w-full md:w-auto btn btn-md btn-primary"
      ><span class="fe fe-plus"></span> Add  Stop</a
      >
      </nz-page-header-extra>
    </nz-page-header>

    <div class="px-6 pb-12">
      <ng-container *ngIf="progressRef.state | async as state">
        <div *ngIf="!state.active; else loadSkeleton">
          <div *ngIf="busStops$ | async as busStops">
            <section *ngIf="busStops.length; else emptyState">
              <div class="grid grid-cols-12 gap-4 items-stretch ">
                <div class="col-span-3 w-64 min-h-full card card-bordered px-3">
                  <div class="flex justify-center py-3">
                    <input nz-input (keyup)="onSearchTermChange($event)" [(ngModel)]="searchTerm"
                           class="input input-sm input-borderedx placeholder-neutral/25"
                           placeholder="Search Stops" type="search">
                  </div>
                  <hr class="mb-2"/>
                  <ul [nzDataSource]="filteredStops|async" [nzNoResult]="filteredStopsEmpty" nz-list nzSplit class=" max-h-100 overflow-y-auto"  nzSize="large">
                    <ng-template #filteredStopsEmpty>
                      <section class="max-w-lg px-4 py-12 lg:py-20 mx-auto">

                        <img class="mx-auto sm:w-2/5" src="assets/images/stops.png" />
                            <h2 *ngIf="searchTerm else emptyFilteredStopsTitle"
                                class="mt-8 text-xl font-medium text-center text-gray-800">
                              No match found
                            </h2>

                        <ng-template #emptyFilteredStopsTitle>
                          <h2 class="mt-8 text-xl font-medium text-center text-gray-800">
                            No student has been assigned this pickup location
                          </h2>
                        </ng-template>

                        <p *ngIf="searchTerm else emptyFilteredStopsListDescription" class="mt-4 text-center text-gray-600">
                          No stop name contains <span class="font-bold">"{{searchTerm}}"</span>
                        </p>

                        <ng-template #emptyFilteredStopsListDescription>
                          <p class="mt-4 text-center text-gray-600">
                            No student have been added to this bus stop(or neighbourhood) <br>
                          </p>
                        </ng-template>

                      </section>
                    </ng-template>
                    <li (click)="selectedStop$$.next(item)" *ngFor="let item of filteredStops|async"
                        [ngClass]='{"bg-primary hover:bg-primary/95 text-primary-content ": selectedStop$$.value?.id === item.id}'
                        class="cursor-pointer rounded-lg mr-1"
                        nz-list-item>
                      <div class="">
                        <div class="text-md font-semibold">{{item.placeGeoName}}</div>
                        <div class="text-sm text-gray-900/75"><span
                          class="fe fe-user mr-2"></span>Driver name</div>
                      </div>
                      <div class="flex items-center space-x-2">
                        <div><span class="fe fe-chevron-right"></span></div>
                      </div>
                    </li>
                  </ul>

                </div>
                <div class="col-span-9">
                  <div class="flex justify-between items-center w-full">
                    <div *ngIf="selectedStop$$|async as place" class="text-lg font-bold">{{place.placeGeoName}}
                    </div>
                    <div class="space-x-3 flex items-center">


                      <button [nzDropdownMenu]="actionMenu" class="btn btn-sm ml-4 btn-accent" nz-dropdown>
                        More <span class="fe fe-more-vertical"></span>
                      </button>
                      <nz-dropdown-menu #actionMenu="nzDropdownMenu">
                        <ul nz-menu>
                          <li (click)="showPreviewLocationModal = true" nz-menu-item><span
                            class="fe fe-map-pin mr-2"></span>
                            View on Map
                          </li>



                          <li (click)="showEditStopModal = true" nz-menu-item><span class="fe fe-edit mr-2"></span>
                            Edit Bus Stop
                          </li>
                          <li (click)="confirmDeletion(selectedStop$$.value)" nz-menu-item><span
                            class="fa fa-times mr-2"></span> Delete
                          </li>
                        </ul>
                      </nz-dropdown-menu>

                    </div>

                  </div>
                  <nz-divider></nz-divider>
                  <div>
                    <section *ngIf="false; else studentsEmptyState">
                      <nz-table [nzData]="[]"
                                [nzLoading]="loading$ | async"
                      >
                        <thead>
                        <tr>
                          <th>Sub-Route</th>
                          <th>Main Rates<span class="text-xs">(Silver/Bronze/Gold)</span></th>
                          <!--                          <th>Departure Schedules</th>-->
                          <!--                          <th>Sub-Routes</th>-->
                          <!--                          <th>Discounts</th>-->
                          <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let data of []">
                          <td>
                            <div class="flex space-x-2 items-center">
                              <div>{{ data.name }}</div>
                            </div>
                          </td>
                          <td>
                            <nz-tag nzColor="#555">{{data.silverPrice|currency:' UGX '}}</nz-tag>
                            <nz-tag nzColor="#8B4513FF">{{data.bronzePrice|currency:' UGX '}}</nz-tag>
                            <nz-tag nzColor="#B8860BFF">{{data.goldPrice |currency:'UGX '}}</nz-tag>
                          </td>
                          <!--                          <td>-->
                          <!--                            <a (click)='showPreviewSchedules = true; selectedRoute$$.next(data)'>View Schedules</a>-->
                          <!--                          </td>-->
                          <!--                          <td>-->
                          <!--                            <nz-tag nzColor='blue'>{{data.subRoutes.length}}</nz-tag>-->
                          <!--                            <a (click)='showPreviewSubRoutes = true; selectedRoute$$.next(data)'>Preview</a>-->
                          <!--                          </td>-->
                          <!--                          <td>-->
                          <!--                            <nz-tag *ngIf='!data.discountRate'>None</nz-tag>-->
                          <!--                            <div *ngIf='data.discountRate'>-->
                          <!--                              <nz-tag *ngIf='data.discountExpiresAfter|amIsAfter:today'-->
                          <!--                                      nzColor='blue'>{{data.discountRate}}%-->
                          <!--                                Off-->
                          <!--                              </nz-tag>-->
                          <!--                              <nz-tag *ngIf='data.discountExpiresAfter|amIsBefore:today' class='animate animate-pulse'-->
                          <!--                                      nzColor='red'>{{data.discountRate}}%-->
                          <!--                                Off <span *ngIf='data.discountExpiresAfter|amIsBefore:today'> has expired</span>-->
                          <!--                              </nz-tag>-->
                          <!--                            </div>-->
                          <!--                          </td>-->
                          <td>
                            <button [routerLink]="'/bus-stops/sub-routes/'+data.id+'/bookings'"
                                    class="btn btn-accent btn-outline btn-sm">
                              Manage Bookings
                            </button>
                          </td>
                        </tr>
                        </tbody>
                      </nz-table>
                    </section>
                    <ng-template #studentsEmptyState>
                      <section class="max-w-lg px-4 py-12 lg:py-20 mx-auto">

                        <img class="mx-auto sm:w-2/5" src="assets/images/students.png" />
<!--                        <h2 *ngIf="searchTerm else emptyListTitle"-->
<!--                            class="mt-8 text-xl font-medium text-center text-gray-800">-->
<!--                          No match found-->
<!--                        </h2>-->

                          <h2 class="mt-8 text-xl font-medium text-center text-gray-800">
                            No student has been assigned this pickup location
                          </h2>

<!--                        <p *ngIf="searchTerm else emptyListDescription" class="mt-4 text-center text-gray-600">-->
<!--                          No stop name contains <span class="font-bold">"{{searchTerm}}"</span>-->
<!--                        </p>-->
                          <p class="mt-4 text-center text-gray-600">
                            No student have been added to this bus stop(or neighbourhood) <br>
                          </p>

                      </section>
                    </ng-template>
                  </div>
                </div>
              </div>
            </section>
            <ng-template #emptyState>
              <section class="max-w-lg px-4 py-12 lg:py-20 mx-auto">
                <img
                  alt="Buses"
                  class="mx-auto sm:w-3/5"
                  src="assets/images/stops.png"
                />
                <h2 *ngIf="searchTerm else emptyListTitle" class="mt-8 text-xl font-medium text-center text-gray-800">
                  No match found
                </h2>
                <ng-template #emptyListTitle>
                  <h2 class="mt-8 text-xl font-medium text-center text-gray-800">
                    Stops are areas in the community where school bus drivers pick up and drop-off students
                  </h2>
                </ng-template>
                <p *ngIf="searchTerm else emptyListDescription" class="mt-4 text-center text-gray-600">
                  No place name contains <span class="font-bold">"{{searchTerm}}"</span>
                </p>
                <ng-template #emptyListDescription>
                  <p class="mt-4 text-center text-gray-600">
                   Stops should be added in areas of the community where a cluster of students lives
                  </p>
                </ng-template>
                <div
                  class="
                    flex flex-col
                    items-center
                    justify-center
                    mt-8
                    space-y-1
                    md:flex-row md:space-y-0 md:space-x-1
                  "
                >
                </div>
              </section>
            </ng-template>
          </div>
        </div>
        <ng-template #loadSkeleton>
          <nz-spin *ngIf="state.active && busStops$ | async" [nzSpinning]="true">
            <nz-skeleton></nz-skeleton>
            <nz-skeleton></nz-skeleton>
            <nz-skeleton></nz-skeleton>
            <nz-skeleton></nz-skeleton>
          </nz-spin>
        </ng-template>




      </ng-container>
    </div>
  </div>

  <bb-add-stop [visible]="showAddStopModal" (hide)="showAddStopModal=false"></bb-add-stop>
  <bb-edit-stop (hide)="showEditStopModal = false; selectedStop$$.next(null)" [stop]="selectedStop$$|async"
                [show]="showEditStopModal"></bb-edit-stop>

  <bb-preview-location (hide)="showPreviewLocationModal = false" [place]="selectedStop$$|async"
                           [show]="showPreviewLocationModal"></bb-preview-location>

<!--  <buspro-assign-stage-manager (hide)="showSupervisorModal=false"-->
<!--                               [show]="showSupervisorModal" [supervisor]="selectedPlace$$.value?.supervisor"-->
<!--                               [terminal]="selectedPlace$$|async"></buspro-assign-stage-manager>-->
</div>
